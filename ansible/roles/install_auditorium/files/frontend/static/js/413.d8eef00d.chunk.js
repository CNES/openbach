"use strict";(self.webpackChunkihm=self.webpackChunkihm||[]).push([[413],{3413:function(n,e,t){t.r(e),t.d(e,{default:function(){return pn}});var a=t(9439),o=t(2791),r=t(4554),i=t(4721),l=t(1134),s=t(6151),c=t(7391),u=t(818),d=t(178),m=t(5346),h=t(184),v=function(n){var e=(0,m.I0)(),t=(0,l.cI)({mode:"onBlur"}),a=t.control,i=t.handleSubmit,v=t.register,f=t.reset,p=t.formState.isValid,g=o.useCallback((function(n){var t=n.job,a=n.file;e((0,d.Y$)({job:t,file:a[0]})),f()}),[e,f]);return(0,h.jsxs)("form",{onSubmit:i(g),children:[(0,h.jsx)(l.Qr,{name:"job",control:a,rules:{required:!0},defaultValue:"",render:function(n){var e=n.field,t=e.onChange,a=e.onBlur,o=e.value,r=e.ref;return(0,h.jsx)(c.Z,{autoFocus:!0,required:!0,margin:"dense",variant:"standard",label:"New Job Name",onChange:t,onBlur:a,value:o,inputRef:r,fullWidth:!0})}}),(0,h.jsx)(u.Z,{required:!0,label:"Definition's file",accept:".tar.gz,.tgz",name:"file",register:v,options:{required:!0}}),(0,h.jsx)(r.Z,{textAlign:"end",children:(0,h.jsx)(s.Z,{type:"submit",variant:"contained",color:"secondary",disabled:!p,children:"Add Job"})})]})},f=t(3433),p=t(9157),g=t(1691),b=t(3366),x=t(7462),j=t(4419),Z=t(8182),y=t(7630),w=t(3736),C=t(5878),I=t(1217);function k(n){return(0,I.Z)("MuiImageList",n)}(0,C.Z)("MuiImageList",["root","masonry","quilted","standard","woven"]);var S=o.createContext({}),P=["children","className","cols","component","rowHeight","gap","style","variant"],A=(0,y.ZP)("ul",{name:"MuiImageList",slot:"Root",overridesResolver:function(n,e){var t=n.ownerState;return[e.root,e[t.variant]]}})((function(n){var e=n.ownerState;return(0,x.Z)({display:"grid",overflowY:"auto",listStyle:"none",padding:0,WebkitOverflowScrolling:"touch"},"masonry"===e.variant&&{display:"block"})})),E=o.forwardRef((function(n,e){var t=(0,w.Z)({props:n,name:"MuiImageList"}),a=t.children,r=t.className,i=t.cols,l=void 0===i?2:i,s=t.component,c=void 0===s?"ul":s,u=t.rowHeight,d=void 0===u?"auto":u,m=t.gap,v=void 0===m?4:m,f=t.style,p=t.variant,g=void 0===p?"standard":p,y=(0,b.Z)(t,P),C=o.useMemo((function(){return{rowHeight:d,gap:v,variant:g}}),[d,v,g]);o.useEffect((function(){0}),[]);var I="masonry"===g?(0,x.Z)({columnCount:l,columnGap:v},f):(0,x.Z)({gridTemplateColumns:"repeat(".concat(l,", 1fr)"),gap:v},f),E=(0,x.Z)({},t,{component:c,gap:v,rowHeight:d,variant:g}),N=function(n){var e=n.classes,t={root:["root",n.variant]};return(0,j.Z)(t,k,e)}(E);return(0,h.jsx)(A,(0,x.Z)({as:c,className:(0,Z.Z)(N.root,N[g],r),ref:e,style:I,ownerState:E},y,{children:(0,h.jsx)(S.Provider,{value:C,children:a})}))})),N=t(4942),J=t(4036),R=t(890),L=t(3840),M=t(2930);function _(n){return(0,I.Z)("MuiInputAdornment",n)}var z,O=(0,C.Z)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]),T=["children","className","component","disablePointerEvents","disableTypography","position","variant"],F=(0,y.ZP)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:function(n,e){var t=n.ownerState;return[e.root,e["position".concat((0,J.Z)(t.position))],!0===t.disablePointerEvents&&e.disablePointerEvents,e[t.variant]]}})((function(n){var e=n.theme,t=n.ownerState;return(0,x.Z)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(e.vars||e).palette.action.active},"filled"===t.variant&&(0,N.Z)({},"&.".concat(O.positionStart,"&:not(.").concat(O.hiddenLabel,")"),{marginTop:16}),"start"===t.position&&{marginRight:8},"end"===t.position&&{marginLeft:8},!0===t.disablePointerEvents&&{pointerEvents:"none"})})),Y=o.forwardRef((function(n,e){var t=(0,w.Z)({props:n,name:"MuiInputAdornment"}),a=t.children,r=t.className,i=t.component,l=void 0===i?"div":i,s=t.disablePointerEvents,c=void 0!==s&&s,u=t.disableTypography,d=void 0!==u&&u,m=t.position,v=t.variant,f=(0,b.Z)(t,T),p=(0,M.Z)()||{},g=v;v&&p.variant,p&&!g&&(g=p.variant);var y=(0,x.Z)({},t,{hiddenLabel:p.hiddenLabel,size:p.size,disablePointerEvents:c,position:m,variant:g}),C=function(n){var e=n.classes,t=n.disablePointerEvents,a=n.hiddenLabel,o=n.position,r=n.size,i=n.variant,l={root:["root",t&&"disablePointerEvents",o&&"position".concat((0,J.Z)(o)),i,a&&"hiddenLabel",r&&"size".concat((0,J.Z)(r))]};return(0,j.Z)(l,_,e)}(y);return(0,h.jsx)(L.Z.Provider,{value:null,children:(0,h.jsx)(F,(0,x.Z)({as:l,ownerState:y,className:(0,Z.Z)(C.root,r),ref:e},f,{children:"string"!==typeof a||d?(0,h.jsxs)(o.Fragment,{children:["start"===m?z||(z=(0,h.jsx)("span",{className:"notranslate",children:"\u200b"})):null,a]}):(0,h.jsx)(R.Z,{color:"text.secondary",children:a})}))})})),B=t(493),U=t(5403),W=t(5699),H=t(1918),D=t(8096),q=(t(7441),t(9103));function V(n){return(0,I.Z)("MuiImageListItem",n)}var Q=(0,C.Z)("MuiImageListItem",["root","img","standard","woven","masonry","quilted"]),G=["children","className","cols","component","rows","style"],K=(0,y.ZP)("li",{name:"MuiImageListItem",slot:"Root",overridesResolver:function(n,e){var t=n.ownerState;return[(0,N.Z)({},"& .".concat(Q.img),e.img),e.root,e[t.variant]]}})((function(n){var e=n.ownerState;return(0,x.Z)({display:"block",position:"relative"},"standard"===e.variant&&{display:"flex",flexDirection:"column"},"woven"===e.variant&&{height:"100%",alignSelf:"center","&:nth-of-type(even)":{height:"70%"}},(0,N.Z)({},"& .".concat(Q.img),(0,x.Z)({objectFit:"cover",width:"100%",height:"100%",display:"block"},"standard"===e.variant&&{height:"auto",flexGrow:1})))})),X=o.forwardRef((function(n,e){var t=(0,w.Z)({props:n,name:"MuiImageListItem"}),a=t.children,r=t.className,i=t.cols,l=void 0===i?1:i,s=t.component,c=void 0===s?"li":s,u=t.rows,d=void 0===u?1:u,m=t.style,v=(0,b.Z)(t,G),f=o.useContext(S),p=f.rowHeight,g=void 0===p?"auto":p,y=f.gap,C=f.variant,I="auto";"woven"===C?I=void 0:"auto"!==g&&(I=g*d+y*(d-1));var k=(0,x.Z)({},t,{cols:l,component:c,gap:y,rowHeight:g,rows:d,variant:C}),P=function(n){var e=n.classes,t={root:["root",n.variant],img:["img"]};return(0,j.Z)(t,V,e)}(k);return(0,h.jsx)(K,(0,x.Z)({as:c,className:(0,Z.Z)(P.root,P[C],r),ref:e,style:(0,x.Z)({height:I,gridColumnEnd:"masonry"!==C?"span ".concat(l):void 0,gridRowEnd:"masonry"!==C?"span ".concat(d):void 0,marginBottom:"masonry"===C?y:void 0},m),ownerState:k},v,{children:o.Children.map(a,(function(n){return o.isValidElement(n)?"img"===n.type||(0,q.Z)(n,["Image"])?o.cloneElement(n,{className:(0,Z.Z)(P.img,n.props.className)}):n:null}))}))})),$=t(4925),nn=t(5484),en=t(9900),tn=t(3786),an=t(9321),on=t(3967),rn=t(1563),ln=function(n,e){var t=null===e||void 0===e?void 0:e.find((function(e){return e.address===n}));return t?"".concat(t.name," (").concat(t.address,")"):n},sn=function(n){var e=n.job,t=n.update,i=n.isCore,l=n.onUpdate,c=e.general,u=c.name,v=c.keywords,f=c.job_version,p=c.description,g=(0,on.Z)(),b=(0,m.I0)(),x=(0,m.v9)((function(n){return n.openbach.agents})),j=o.useState([]),Z=(0,a.Z)(j,2),y=Z[0],w=Z[1],C=o.useState({}),I=(0,a.Z)(C,2),k=I[0],S=I[1],P=o.useCallback((function(n){var e=n.target.value;w("string"===typeof e?[]:e)}),[]),A=o.useCallback((function(){b(i?(0,d.hX)({name:u}):(0,d.Q7)({name:u}))}),[b,i,u]),E=o.useCallback((function(){var n=y.filter((function(n){return k.hasOwnProperty(n)})),e=y.filter((function(n){return!k.hasOwnProperty(n)})),t=Object.keys(k).filter((function(n){return!y.includes(n)}));l({name:u,install:e,remove:t,update:n})}),[u,y,k,l]);o.useEffect((function(){var n=b((0,d.rM)({jobName:u}));return n.unwrap().then((function(n){var e=n.installed_on;S(Object.fromEntries(e.map((function(n){return[n.agent__address,n.agent__name]})))),w(e.map((function(n){return n.agent__address})))})),function(){n.abort()}}),[b,u]);var N=g.typography,J=N.fontWeightMedium,R=N.fontWeightRegular,L=null===t||void 0===t?void 0:t.version,M=L===f?"This is the lattest version available":"Update to version ".concat(L);return(0,h.jsx)(X,{children:(0,h.jsx)(rn.Z,{primary:u,secondary:"Keywords: "+v.join(", "),nestedItems:(0,h.jsxs)(o.Fragment,{children:[(0,h.jsx)(nn.ZP,{children:(0,h.jsx)(en.Z,{primary:"Version: "+f,secondary:L&&M})}),L&&L!==f&&(0,h.jsx)(nn.ZP,{children:(0,h.jsx)(en.Z,{inset:!0,sx:{textAlign:"end"},children:(0,h.jsx)(s.Z,{color:"secondary",variant:"contained",onClick:A,children:M})})}),(0,h.jsx)(nn.ZP,{children:(0,h.jsx)(en.Z,{primary:"Description"})}),(0,h.jsx)(nn.ZP,{children:(0,h.jsx)(en.Z,{inset:!0,primary:p})}),(0,h.jsx)(nn.ZP,{children:(0,h.jsx)(en.Z,{primary:"Installed on"})}),(0,h.jsx)(nn.ZP,{children:(0,h.jsx)(en.Z,{inset:!0,children:(0,h.jsxs)(D.Z,{fullWidth:!0,sx:{m:1,width:300},children:[(0,h.jsx)($.Z,{id:"".concat(u,"-multiple-chip-label"),children:"Agents"}),(0,h.jsx)(an.Z,{labelId:"".concat(u,"-multiple-chip-label"),id:"".concat(u,"-multiple-chip-select"),label:"Agents",multiple:!0,fullWidth:!0,value:y,onChange:P,renderValue:function(n){return(0,h.jsx)(r.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map((function(n){return(0,h.jsx)(H.Z,{label:ln(n,x)},n)}))})},children:null===x||void 0===x?void 0:x.map((function(n){var e=n.name,t=n.address;return(0,h.jsxs)(tn.Z,{value:t,sx:{fontWeight:-1===y.indexOf(t)?R:J},children:[e," (",t,")"]},e)}))})]})})}),(0,h.jsx)(nn.ZP,{children:(0,h.jsx)(en.Z,{inset:!0,sx:{textAlign:"end"},children:(0,h.jsx)(s.Z,{color:"secondary",variant:"contained",onClick:E,children:"Update"})})})]})})})},cn=t(5616),un=function(n){return function(e){var t=null===n||void 0===n?void 0:n.find((function(n){return n.address===e}));return t?"".concat(t.name," at ").concat(t.address):e}},dn=function(n){var e=n.introduction,t=n.elements;return t.length?(0,h.jsxs)("p",{children:[e,(0,h.jsx)("ul",{children:t.map((function(n){return(0,h.jsx)("li",{children:n})}))})]}):null},mn=function(n){var e=n.internalJobs,t=n.externalJobs,r=o.useState(),i=(0,a.Z)(r,2),l=i[0],s=i[1],u=o.useState({install:[],remove:[],update:[]}),v=(0,a.Z)(u,2),b=v[0],x=v[1],j=(0,m.v9)((function(n){return n.openbach.jobs})),Z=(0,m.v9)((function(n){return n.openbach.agents})),y=(0,m.I0)(),w=o.useCallback((function(n){s(n.target.value)}),[]),C=o.useCallback((function(n){x(n)}),[]),I=o.useCallback((function(){x({install:[],remove:[],update:[]})}),[]),k=o.useCallback((function(n,e,t){y((0,d.Kn)({jobName:n,agent:e})).unwrap().then((function(a){var o=a[t];o&&202!==o.returncode?y((0,cn.PJ)(t+"ation of the job "+n+" on agent "+e+" ended with status code "+o.returncode)):setTimeout((function(){return k(n,e,t)}),2e3)}))}),[y]),S=o.useCallback((function(n,e){e.length&&(y((0,d.eJ)({jobNames:[n],agents:e})).unwrap().then((function(){y((0,cn.PJ)("Started installation for "+n))})),e.forEach((function(e){setTimeout((function(){return k(n,e,"install")}),2e3)})))}),[y,k]),P=o.useCallback((function(n,e){e.length&&(y((0,d.xT)({jobNames:[n],agents:e})).unwrap().then((function(){y((0,cn.PJ)("Started uninstallation for "+n))})),e.forEach((function(e){setTimeout((function(){return k(n,e,"uninstall")}),2e3)})))}),[y,k]),A=o.useCallback((function(){var n=b.name,e=b.install,t=b.remove;n&&(S(n,e),P(n,t)),I()}),[b,S,P,I]),N=o.useCallback((function(){var n=b.name,e=b.install,t=b.update,a=b.remove;n&&(S(n,[].concat((0,f.Z)(e),(0,f.Z)(t))),P(n,a)),I()}),[b,S,P,I]),J=(j||[]).filter((function(n){return-1!==n.general.name.search(l)||-1!==n.general.description.search(l)||-1!==n.general.keywords.findIndex((function(n){return-1!==n.search(l)}))})).sort((function(n,e){return n.general.name.localeCompare(e.general.name)})).map((function(n,a){var o=function(e){return e.name===n.general.name},r=e.find(o),i=r||t.find(o);return(0,h.jsx)(sn,{job:n,update:i,isCore:Boolean(r),onUpdate:C},a)})),R=function(n,e,t){var a="Additionally, you can also update it on";return n&&e?t?["Install, Remove AND Update","Install and Remove ONLY",a]:[null,"Install and Remove Job on Agents",a]:e?t?["Remove AND Update","Remove ONLY",a]:[null,"Remove Job on Agents",a]:n?t?["Install AND Update","Install ONLY",a]:[null,"Install Job on Agents",a]:t?["Update Job on Agents",null,"You will update it on"]:[null,null,a]}(0!==b.install.length,0!==b.remove.length,0!==b.update.length),L=(0,a.Z)(R,3),M=L[0],_=L[1],z=L[2],O=(M?[{label:M,action:N}]:[]).concat(_?[{label:_,action:A}]:[]);return(0,h.jsxs)(o.Fragment,{children:[(0,h.jsx)(c.Z,{autoFocus:!0,margin:"dense",variant:"standard",color:"secondary",label:"FilterJobs",value:l,onChange:w,InputProps:{endAdornment:(0,h.jsx)(Y,{position:"end",children:(0,h.jsx)(U.Z,{})})},fullWidth:!0}),(0,h.jsx)(B.Z,{children:(0,h.jsx)(E,{cols:3,gap:8,variant:"masonry",children:J})}),(0,h.jsx)(W.Z,{title:"(Un)Install Job on Agents",open:Boolean(b.name)&&0!==O.length,cancel:{label:"Cancel",action:I},actions:O,children:(0,h.jsx)(p.Z,{children:(0,h.jsxs)(g.Z,{children:[(0,h.jsxs)("p",{children:["You are about to manage the job ",b.name," on your agents!"]}),(0,h.jsx)(dn,{introduction:"You will install it on",elements:b.install.map(un(Z))}),(0,h.jsx)(dn,{introduction:"You will remove it on",elements:b.remove.map(un(Z))}),(0,h.jsx)(dn,{introduction:z,elements:b.update.map(un(Z))})]})})})]})},hn=t(6278),vn=function(n){var e=n.externalJobs,t=o.useState(),r=(0,a.Z)(t,2),i=r[0],l=r[1],s=(0,m.I0)(),c=o.useCallback((function(n){return function(){l(n)}}),[]),u=o.useCallback((function(){l(void 0)}),[]),v=o.useCallback((function(){i&&s((0,d.Q7)({name:i})),l(void 0)}),[i,s]),f=e.map((function(n){return(0,h.jsx)(hn.Z,{onClick:c(n.name),children:(0,h.jsx)(en.Z,{primary:n.display})},n.name)}));return f.length||f.push((0,h.jsx)(hn.Z,{disabled:!0,children:(0,h.jsx)(en.Z,{primary:"No jobs available"})},"unavailable")),(0,h.jsxs)(o.Fragment,{children:[(0,h.jsx)(B.Z,{children:f}),(0,h.jsx)(W.Z,{title:"Install External Job",open:Boolean(i),cancel:{label:"Cancel",action:u},actions:[{label:"Install",action:v}],children:(0,h.jsxs)(p.Z,{children:[(0,h.jsxs)(g.Z,{children:["You are about to add the job ",i," into the controller. For more informations, you can browse the job descriptions on ",(0,h.jsx)("a",{href:"https://github.com/CNES/openbach/blob/master/src/jobs/README.md",target:"_blank",rel:"noreferrer",children:"the OpenBACH wiki"}),"."]}),(0,h.jsx)(g.Z,{children:"Proceed?"})]})})]})},fn=t(2050),pn=function(n){var e=(0,m.v9)((function(n){return n.login.is_admin})),t=o.useState([]),l=(0,a.Z)(t,2),s=l[0],c=l[1],u=o.useState([]),f=(0,a.Z)(u,2),p=f[0],g=f[1],b=(0,m.I0)();return o.useEffect((function(){b((0,cn.Td)("OpenBach Administration"));var n=b((0,d.Tw)()),e=b((0,d.bs)()),t=[b((0,d.Ly)()),b((0,fn.j8)({services:!1})),n,e];return n.unwrap().then((function(n){c(n)})),e.unwrap().then((function(n){g(n)})),function(){t.forEach((function(n){n.abort()}))}}),[b]),(0,h.jsxs)(o.Fragment,{children:[(0,h.jsx)("h1",{children:"Available Jobs"}),e&&(0,h.jsxs)(r.Z,{display:"inline-block",marginRight:"10%",sx:{verticalAlign:"top"},width:"20%",children:[(0,h.jsx)("h2",{children:"Add a new Job"}),(0,h.jsx)(r.Z,{component:"p",textAlign:"justify",children:"Please provide a tar.gz file containing the top-level directory of the job's definition files."}),(0,h.jsx)(r.Z,{component:"p",textAlign:"justify",children:'Most likely the tar.gz file should contain a "files" directory, the "install_<job_name>.yml" file and the "uninstall_<job_name>.yml" file; all located at the root of the archive.'}),(0,h.jsx)(v,{}),(0,h.jsx)(i.Z,{sx:{mt:3,mb:3}}),(0,h.jsx)("h2",{children:"Install a supported external Job"}),(0,h.jsx)(vn,{externalJobs:s})]}),(0,h.jsx)(r.Z,{display:e?"inline-block":void 0,width:e?"70%":void 0,children:(0,h.jsx)(mn,{internalJobs:p,externalJobs:s})})]})}},5403:function(n,e,t){var a=t(4836);e.Z=void 0;var o=a(t(5649)),r=t(184),i=(0,o.default)((0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"Search");e.Z=i}}]);
//# sourceMappingURL=413.d8eef00d.chunk.js.map