"use strict";(self.webpackChunkihm=self.webpackChunkihm||[]).push([[303],{303:function(e,n,r){r.r(n),r.d(n,{default:function(){return G}});var t=r(2791),a=r(4554),l=r(9439),o=r(1134),i=r(6151),s=r(8096),c=r(4925),u=r(3786),d=r(9321),h=r(3896),f=r(5228),x=r(7391),p=r(818),v=r(2050),j=r(5346),m=r(5616),g=r(184),b=function(e){var n=e.value,r=e.selected,t=e.children,a=n!==r;return(0,g.jsx)("div",{role:"tabpanel",hidden:a,children:!a&&t})},Z=function(e){var n=(0,j.v9)((function(e){return e.openbach.collectors})),r=(0,j.I0)(),Z=(0,o.cI)({mode:"onBlur"}),y=Z.control,C=Z.handleSubmit,w=Z.register,k=Z.reset,B=Z.formState.isValid,A=t.useState("password"),_=(0,l.Z)(A,2),P=_[0],q=_[1],S=t.useCallback((function(e,n){q(n)}),[]),R=t.useCallback((function(e){return function(n){var t=n.name,a=n.address,l=n.collector,o=n.username,i=n.password,s=n.http_proxy,c=n.https_proxy,u=n.private_key[0],d=n.public_key[0],h="password"===P?{name:t,address:a,collector_ip:l,username:o,password:i,http_proxy:s,https_proxy:c}:{name:t,address:a,collector_ip:l,username:o,public_key:d,private_key:u,http_proxy:s,https_proxy:c};r((0,v.o0)({reattach:e,agent:h})),k()}}),[r,P,k]),W=t.useCallback((function(e){var n=Object.entries(e).filter((function(e){var n=(0,l.Z)(e,2),r=(n[0],n[1]);return!(null!==r&&void 0!==r&&r.message)})).map((function(e){var n=(0,l.Z)(e,2),r=n[0];n[1];return r.replace(/\b\w/g,(function(e){return e.toUpperCase()}))}));n.length&&r((0,m.PJ)("The following fields are missing to create an Agent: "+n.join(", ")))}),[r]),E=t.useMemo((function(){return n?n.map((function(e){return e.address})):[]}),[n]);return E.length?(0,g.jsxs)("form",{onSubmit:C(R(!1),W),children:[(0,g.jsxs)("fieldset",{children:[(0,g.jsx)("legend",{children:"Connect with"}),(0,g.jsxs)(f.Z,{value:P,onChange:S,centered:!0,variant:"fullWidth",children:[(0,g.jsx)(h.Z,{label:"Password",value:"password"}),(0,g.jsx)(h.Z,{label:"SSH Keys",value:"keys"})]}),(0,g.jsx)(o.Qr,{name:"username",control:y,rules:{required:!0},defaultValue:"",render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{autoFocus:!0,required:!0,margin:"dense",variant:"standard",label:"Username",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}}),(0,g.jsx)(b,{value:"password",selected:P,children:(0,g.jsx)(o.Qr,{name:"password",control:y,rules:{validate:function(e){return"password"!==P||Boolean(e)}},defaultValue:"",render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{required:!0,margin:"dense",variant:"standard",label:"Password",type:"password",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}})}),(0,g.jsxs)(b,{value:"keys",selected:P,children:[(0,g.jsx)(p.Z,{required:!0,label:"Public Key",accept:".pub",color:"primary",variant:"contained",sx:{width:"100%",mt:2},name:"public_key",register:w,options:{validate:function(e){return"keys"!==P||(null===e||void 0===e?void 0:e.length)>0}}}),(0,g.jsx)(p.Z,{required:!0,label:"Private Key",color:"primary",variant:"contained",sx:{width:"100%",mt:2},name:"private_key",register:w,options:{validate:function(e){return"keys"!==P||(null===e||void 0===e?void 0:e.length)>0}}})]})]}),(0,g.jsxs)("fieldset",{children:[(0,g.jsx)("legend",{children:"Create Agent"}),(0,g.jsx)(o.Qr,{name:"name",control:y,rules:{required:!0},defaultValue:"",render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{required:!0,margin:"dense",variant:"standard",label:"Name",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}}),(0,g.jsx)(o.Qr,{name:"address",control:y,rules:{required:!0},defaultValue:"",render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{required:!0,margin:"dense",variant:"standard",label:"IP Address",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}}),(0,g.jsx)(o.Qr,{name:"collector",control:y,rules:{required:!0},defaultValue:"",render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsxs)(s.Z,{fullWidth:!0,sx:{mt:3},children:[(0,g.jsx)(c.Z,{id:"collectors-label-for-add-new",children:"Collector *"}),(0,g.jsx)(d.Z,{required:!0,labelId:"collectors-label-for-add-new",id:"collectors-select-for-add-new",label:"Collector *",onChange:r,onBlur:t,value:a,inputRef:l,children:E.map((function(e){return(0,g.jsx)(u.Z,{value:e,children:e},e)}))})]})}}),(0,g.jsx)(o.Qr,{name:"http_proxy",control:y,rules:{required:!1},defaultValue:"",render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{margin:"dense",variant:"standard",label:"HTTP Proxy",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}}),(0,g.jsx)(o.Qr,{name:"https_proxy",control:y,rules:{required:!1},defaultValue:"",render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{margin:"dense",variant:"standard",label:"HTTPS Proxy",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}})]}),(0,g.jsxs)(a.Z,{textAlign:"end",children:[(0,g.jsx)(i.Z,{variant:"contained",color:"secondary",disabled:!B,type:"submit",sx:{m:2},children:"Add New Agent"}),(0,g.jsx)(i.Z,{variant:"contained",color:"secondary",disabled:!B,onClick:C(R(!0),W),sx:{m:2},children:"Attach Existing Agent"})]})]}):(0,g.jsxs)(t.Fragment,{children:[(0,g.jsx)("p",{children:"No collector found! Cannot add an agent without a collector!"}),(0,g.jsx)("p",{children:"Please contact your administrator"})]})},y=r(493),C=r(6125),w=r(6278),k=r(7064),B=r(9900),A=r(2885),_=r(1131),P=r(8655),q=r(4679),S=r(7243),R=r(2460),W=r(7),E=r(1258),T=r(5519),I=r(7630),V=r(9157),F=r(1691),N=r(5699),O=function(e){var n=e.open,r=e.onClose,a=e.initialValues,i=(0,j.v9)((function(e){return e.openbach.collectors})),h=(0,j.I0)(),f=(0,o.cI)({defaultValues:a}),p=f.control,b=f.handleSubmit,Z=f.reset,y=t.useMemo((function(){if(!i)return[a.collector];var e=i.map((function(e){return e.address}));return a.collector&&!e.includes(a.collector)&&e.push(a.collector),e}),[a.collector,i]),C=t.useCallback((function(e){var n=a.name,t=a.address,l=a.collector;n===e.name&&t===e.address&&l===e.collector?h((0,m.PJ)("No changes made to the agent; will not update")):h((0,v.sE)({address:t,agent:{name:e.name,agent_ip:e.address,collector_ip:e.collector}})),r()}),[a,r,h]),w=t.useCallback((function(e){var n=Object.entries(e).filter((function(e){var n=(0,l.Z)(e,2),r=(n[0],n[1]);return!(null!==r&&void 0!==r&&r.message)})).map((function(e){var n=(0,l.Z)(e,2),r=n[0];n[1];return r.replace(/\b\w/g,(function(e){return e.toUpperCase()}))}));n.length&&h((0,m.PJ)("The following fields are missing to update an Agent: "+n.join(", ")))}),[h]),k=t.useCallback((function(){Z(a),r()}),[a,Z,r]);return(0,g.jsx)(N.Z,{title:"Update an Agent",open:n,onSubmit:b(C,w),cancel:{label:"Cancel",action:k},actions:[{label:"OK",action:"submit"}],children:(0,g.jsxs)(V.Z,{children:[(0,g.jsx)(o.Qr,{name:"name",control:p,rules:{required:!0},render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{autoFocus:!0,required:!0,margin:"dense",variant:"standard",label:"Name",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}}),(0,g.jsx)(o.Qr,{name:"address",control:p,rules:{required:!0},render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,a=n.value,l=n.ref;return(0,g.jsx)(x.Z,{required:!0,margin:"dense",variant:"standard",label:"Address",onChange:r,onBlur:t,value:a,inputRef:l,fullWidth:!0})}}),(0,g.jsx)(o.Qr,{name:"collector",control:p,rules:{required:!0},render:function(e){var n=e.field,r=n.onChange,t=n.onBlur,l=n.value,o=n.ref;return(0,g.jsxs)(s.Z,{fullWidth:!0,sx:{mt:2},children:[(0,g.jsx)(c.Z,{id:"collectors-label-for-".concat(a.name),children:"Collector"}),(0,g.jsx)(d.Z,{labelId:"collectors-label-for-".concat(a.name),id:"collectors-select-for-".concat(a.name),label:"Collector",onChange:r,onBlur:t,value:l,inputRef:o,children:y.map((function(e){return(0,g.jsx)(u.Z,{value:e,children:e},e)}))})]})}})]})})},Q=function(e){var n=e.name,r=e.address,o=e.collector,s=(0,j.I0)(),c=t.useState(!1),u=(0,l.Z)(c,2),d=u[0],h=u[1],f=t.useState(),x=(0,l.Z)(f,2),p=x[0],m=x[1],b=t.useState(202),Z=(0,l.Z)(b,2),y=Z[0],C=Z[1],w=t.useState({}),k=(0,l.Z)(w,2),B=k[0],A=k[1],_=t.useCallback((function(){A({})}),[]),P=t.useCallback((function(){m((function(e){switch(e){case"uninstall":s((0,v.e9)({address:r,detach:!1})).then(_);break;case"detach":s((0,v.e9)({address:r,detach:!0})).then(_)}}))}),[r,s,_]),q=t.useCallback((function(){m(void 0)}),[]),S=t.useCallback((function(){m("uninstall")}),[]),R=t.useCallback((function(){m("detach")}),[]),W=t.useCallback((function(){h(!0)}),[]),E=t.useCallback((function(){h(!1)}),[]);t.useEffect((function(){var e,n=s((0,v.Cc)({address:r}));return n.unwrap().then((function(n){var r=n.install,t=n.uninstall;if(r||t){var a=new Date(r?r.last_operation_date:0)<new Date(t?t.last_operation_date:0)?t:r,l=a?a.returncode:202;202===l&&(e=setTimeout(_,2e3)),C(l)}else C(200)})).catch((function(e){"AbortError"!==e.name&&C(500)})),function(){n.abort(),clearTimeout(e)}}),[B,r,s,_]);var T=200===y||204===y,I=T?"secondary":"primary";return 202===y?(0,g.jsx)(a.Z,{display:"flex",flexDirection:"row",mt:2,children:(0,g.jsx)(i.Z,{disabled:!0,variant:"contained",sx:{mx:1},children:"Operation Pending"})}):(0,g.jsxs)(a.Z,{display:"flex",flexDirection:"row",mt:2,children:[(0,g.jsx)(i.Z,{variant:"contained",color:I,onClick:S,sx:{mx:1},children:T?"Uninstall":"Error "+y}),(0,g.jsx)(i.Z,{variant:"contained",color:I,onClick:W,sx:{mx:1},children:"Update"}),(0,g.jsx)(i.Z,{variant:"contained",color:I,onClick:R,sx:{mx:1},children:"Detach"}),(0,g.jsx)(N.Z,{title:"Are you sure?",open:Boolean(p),cancel:{label:"Cancel",action:q},actions:[{label:"OK",action:P}],children:(0,g.jsx)(V.Z,{children:(0,g.jsxs)(F.Z,{children:["Trully ",p," this agent?"]})})}),(0,g.jsx)(O,{open:d,onClose:E,initialValues:{name:n,address:r,collector:o}})]})},M=(0,I.ZP)("section")({padding:"3px 3%"}),H=(0,I.ZP)("h1")({margin:"0 -1%"}),U=function(e){if(!e)return(0,g.jsx)(a.Z,{component:"span",color:R.Z[500],children:"not"})},z=function(e){var n=e.agent,r=(0,j.I0)(),o=(0,j.v9)((function(e){return e.openbach.projects})),i=(0,j.v9)((function(e){return e.login.is_admin})),h=t.useState(!1),f=(0,l.Z)(h,2),x=f[0],p=f[1],m=t.useCallback((function(){p((function(e){return!e}))}),[]),b=t.useCallback((function(e){r((0,v.oH)({address:n.address,projectName:e.target.value}))}),[n.address,r]),Z=n.project?(0,g.jsxs)("p",{children:["Associated to project ",n.project]}):i?(0,g.jsx)("div",{children:(0,g.jsxs)(s.Z,{fullWidth:!0,children:[(0,g.jsx)(c.Z,{id:"project-label-for-".concat(n.name),children:"Reserve for Project"}),(0,g.jsxs)(d.Z,{labelId:"project-label-for-".concat(n.name),id:"project-select-for-".concat(n.name),value:n.reserved||"",label:"Reserve for Project",onChange:b,children:[(0,g.jsx)(u.Z,{value:"",children:"--- Select a Project ---"}),null===o||void 0===o?void 0:o.map((function(e){return(0,g.jsx)(u.Z,{value:e.name,children:e.name},e.name)}))]})]})}):n.reserved?(0,g.jsxs)("p",{children:["Reserved for project ",n.reserved]}):(0,g.jsx)("p",{children:"Not associated to any project"}),y=n.reachable?n.available?(0,g.jsx)(S.Z,{sx:{color:W.Z[500]}}):(0,g.jsx)(P.Z,{sx:{color:E.Z[500]}}):(0,g.jsx)(q.Z,{sx:{color:R.Z[500]}}),I=n.services||{},V=Object.entries(I).filter((function(e){var n=(0,l.Z)(e,2),r=n[0],t=n[1];return"ntp.service"!==r&&void 0!==t&&null!==t})).map((function(e){var n=(0,l.Z)(e,2),r=n[0],t=n[1],o=t?"running"===t?W.Z[500]:R.Z[500]:T.Z[500];return(0,g.jsxs)("p",{children:[r," is ",(0,g.jsx)(a.Z,{component:"span",color:o,children:t})]},r)})),F=I["ntp.service"];return(0,g.jsxs)(t.Fragment,{children:[(0,g.jsxs)(w.Z,{onClick:m,children:[(0,g.jsx)(k.Z,{children:y}),(0,g.jsx)(B.Z,{primary:n.name,secondary:n.address}),x?(0,g.jsx)(A.Z,{}):(0,g.jsx)(_.Z,{})]}),(0,g.jsx)(C.Z,{in:x,timeout:"auto",unmountOnExit:!0,children:(0,g.jsxs)(a.Z,{px:2,children:[(0,g.jsx)("h1",{children:n.name}),(0,g.jsxs)(M,{children:[(0,g.jsx)(H,{children:"General"}),(0,g.jsxs)("p",{children:["Address: ",n.address]}),(0,g.jsxs)("p",{children:["Collector: ",n.collector_ip]}),(0,g.jsxs)("p",{children:["Agent is ",U(n.reachable)," reachable and ",U(n.available)," available"]}),Z,i&&(0,g.jsx)(Q,{name:n.name,address:n.address,collector:n.collector_ip,reachable:n.reachable,available:n.available})]}),Boolean(n.errors&&n.errors.length)&&(0,g.jsxs)(M,{children:[(0,g.jsxs)(H,{children:["Error",n.errors.length>1?"s":""]}),n.errors.map((function(e,n){var r=e.msg;return(0,g.jsx)("p",{children:r},n)}))]}),Boolean(F)&&(0,g.jsxs)(M,{children:[(0,g.jsx)(H,{children:"NTP"}),(0,g.jsx)("code",{children:(0,g.jsx)("pre",{children:F})})]}),Boolean(V.length)&&(0,g.jsxs)(M,{children:[(0,g.jsxs)(H,{children:["Service",V.length>1?"s":""]}),V]})]})})]})},D=function(e){var n=(0,j.v9)((function(e){return e.openbach.agents}));return n?(0,g.jsxs)(t.Fragment,{children:[(0,g.jsx)("h1",{children:"Agents"}),(0,g.jsx)(y.Z,{children:n.map((function(e){return(0,g.jsx)(z,{agent:e},e.name)}))})]}):(0,g.jsx)("h1",{children:"Fetching Agents, please wait!"})},K=r(1524),J=function(e){var n=(0,j.v9)((function(e){return e.openbach.agents})),r=(0,j.v9)((function(e){return e.openbach.projects}));if(!r)return(0,g.jsx)("h1",{children:"Fetching Projects, please wait!"});var a=Object.fromEntries(r.map((function(e){return[e.name,{name:e.name,id:e.name,type:"project"}]}))),l=[],o=(n||[]).map((function(e){var n=r.find((function(n){return void 0!==n.entity.find((function(n){return n.agent&&n.agent.address===e.address}))})),t={name:e.name,id:e.name,type:"entity"};return n&&(t.color="#757575",l.push({source:t,target:a[n.name],weight:3})),t}));return(0,g.jsxs)(t.Fragment,{children:[(0,g.jsx)("h1",{children:"Projects Topology"}),(0,g.jsx)(K.Z,{height:"500px",nodes:o.concat(Object.values(a)),links:l})]})},L=r(5522),G=function(e){var n=(0,j.I0)();return t.useEffect((function(){n((0,m.Td)("OpenBach Administration"));var e=[n((0,v.ov)()),n((0,L.mW)()),n((0,v.j8)({services:!0}))];return function(){e.forEach((function(e){e.abort()}))}}),[n]),(0,g.jsxs)(t.Fragment,{children:[(0,g.jsxs)(a.Z,{display:"inline-block",width:"70%",sx:{verticalAlign:"top"},children:[(0,g.jsx)(D,{}),(0,g.jsx)(J,{})]}),(0,g.jsx)(a.Z,{display:"inline-block",boxSizing:"border-box",pl:2,width:"30%",sx:{verticalAlign:"top"},children:(0,g.jsx)(Z,{})})]})}},1524:function(e,n,r){var t=r(9439),a=r(2791),l=r(5002),o=r(184),i={entity:"/assets/server.svg",network:"/assets/cloud.svg",project:"/assets/project.svg"};n.Z=function(e){var n=e.height,r=e.nodes,s=e.links,c=e.selectedNode,u=e.unselectNode,d=function(){var e=a.useState({width:void 0,height:void 0}),n=(0,t.Z)(e,2),r=n[0],l=n[1];return a.useEffect((function(){var e=function(){l({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),r}(),h=a.useRef(null);return a.useEffect((function(){if(h.current){for(;h.current.children.length>0;)h.current.children[0].remove();var e=h.current.clientHeight,n=h.current.clientWidth,t=l.A4v(r).force("link",l.Fsl(s).id((function(e){return e.id})).strength((function(e){return e.weight}))).force("collide",l.Hh(30)).force("center-x",l.RUJ(0)).force("center-y",l.Mrm(0)).on("tick",(function(){d.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),f.attr("transform",(function(e){return"translate(".concat(e.x,", ").concat(e.y,")")}))})),a=l.Ys(h.current).attr("viewBox",[-n/2,-e/2,n,e]).attr("style","max-width: 100%; height: auto; height: intrinsic;"),o=a.append("rect").attr("fill","white").attr("height",e).attr("width",n).attr("x",-n/2).attr("y",-e/2),d=a.append("g").attr("class","links").selectAll(".link").data(s).enter().append("line").attr("stroke","#AAA").attr("stroke-width",(function(e){return Math.sqrt(e.weight)})),f=a.append("g").attr("class","nodes").selectAll(".node").data(r).enter().append("g").on("dblclick",(function(e,n){n.fx=null,n.fy=null})).call(l.ohM().on("start",(function(e){e.active||t.alphaTarget(.3).restart(),e.subject.fx=e.subject.x,e.subject.fy=e.subject.y})).on("drag",(function(e){e.subject.fx=e.x,e.subject.fy=e.y})).on("end",(function(e){e.active||t.alphaTarget(0)})));return f.append("svg:image").attr("height",30).attr("width",30).attr("x",-15).attr("y",-15).attr("xlink:href",(function(e){return i[e.type]})),f.append("text").text((function(e){return e.name})).attr("cursor","pointer").attr("dx",12).attr("dy",".35em").style("fill",(function(e){return e.color?e.color:"network"===e.type?"#757575":"black"})),c&&f.on("click",(function(e,n){return c(n)})),u&&o.on("click",u),function(){t.stop()}}}),[r,s,c,u,d]),(0,o.jsx)("svg",{ref:h,height:n,width:"100%"})}},8655:function(e,n,r){var t=r(4836);n.Z=void 0;var a=t(r(5649)),l=r(184),o=(0,a.default)((0,l.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"}),"Cloud");n.Z=o},7243:function(e,n,r){var t=r(4836);n.Z=void 0;var a=t(r(5649)),l=r(184),o=(0,a.default)((0,l.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM10 17l-3.5-3.5 1.41-1.41L10 14.17 15.18 9l1.41 1.41L10 17z"}),"CloudDone");n.Z=o}}]);
//# sourceMappingURL=303.e7acd5ff.chunk.js.map